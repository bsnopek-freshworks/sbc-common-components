(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{177:function(e,t,s){"use strict";s.r(t);var r=s(0),n=Object(r.a)({},(function(){var e=this.$createElement;this._self._c;return this._m(0)}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"tokenservice"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tokenservice"}},[e._v("#")]),e._v(" TokenService")]),e._v(" "),s("p",[e._v("This is an abstraction over they keycloak javascript adapter providing some methods to refresh the token.\nThe abstraction is provided so that COOPS-UI project or any other consumer of auth-web can stay independent of keycloak logic.")]),e._v(" "),s("p",[e._v("It supports two modes for "),s("strong",[e._v("refreshing the token")])]),e._v(" "),s("h3",{attrs:{id:"timer-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#timer-mode"}},[e._v("#")]),e._v(" Timer Mode")]),e._v(" "),s("p",[e._v("In this case , it runs a timer [a plain old javascript settimeout] . It calculates the expiry of current keycloak token and schedules a timeout before 2 seconds of expiry\nSince the timers get destroyed on page refresh , execute the logic in start up or when user signs in")]),e._v(" "),s("p",[e._v("a sample usage")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Register the compoent in vue")]),e._v(" "),s("p",[s("code",[e._v("Vue.prototype.$tokenServices = new TokenServices()")])])]),e._v(" "),s("li",[s("p",[e._v("Init the tokenservice so that keycloak service is being set up")])]),e._v(" "),s("li",[s("p",[e._v("start the timer")]),e._v(" "),s("div",{staticClass:"language-if (sessionStorage.getItem('KEYCLOAK_TOKEN')) { extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    // eslint-disable-next-line no-console\n    console.info('[APP.vue] Token exists.So start the refreshtimer')\n    var self = this\n    this.$tokenServices.initUsingUrl(`/${process.env.VUE_APP_PATH}/config/kc/keycloak.json`).then(function (success) {\n      self.$tokenServices.scheduleRefreshTimer()\n    })\n\n")])])])])]),e._v(" "),s("h3",{attrs:{id:"one-time-refresh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#one-time-refresh"}},[e._v("#")]),e._v(" One time Refresh")]),e._v(" "),s("p",[e._v("If a one time refreshal of logic is needed , the service has the method refreshToken() which can be employed.")]),e._v(" "),s("p",[e._v("When KC is initialised using token , the token gets refreshed.So init itself refreshes. The below code will refresh")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("   let tokenservice = new TokenService()\n         tokenservice.initUsingUrl(`/${process.env.VUE_APP_PATH}/config/kc/keycloak.json`).then(function (token) {\n           originalRequest.headers['Authorization'] = `Bearer ${token}`\n           return axios(originalRequest)\n         }).catch(error => {\n           // cant refresh..Probably refresh token expired\n           return Promise.reject(error)\n         })\n")])])]),s("p",[s("code",[e._v("tokenservice.refreshToken()")]),e._v(" will refresh the token as well")])])}],!1,null,null,null);t.default=n.exports}}]);